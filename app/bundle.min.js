!function(e){e.__env=e.__env||{},e.__env.apiUrl="http://localhost:8003",e.__env.baseUrl="/",e.__env.supportEmail="jknight@lunenfeld.ca",e.__env.supportName="James Knight",e.__env.clientID="498894175021-2v85kl2dnmnsqsaqo94a5ls6gsjbj7u4"}(this),angular.module("custom.scrollbar",[]).provider("scrollbarConfig",function(){var e={backgroundColor:"rgba(255, 255, 255, 0)",borderRadius:10,boxShadow:"inset 0 0 3px #37474f",buttonBorderRadius:10,buttonColor:"#bd9a65",display:"none",offsetRight:12,rightOffset:2,width:12},t=angular.extend({},e);this.$get=[function(){return{backgroundColor:t.backgroundColor,borderRadius:t.borderRadius,boxShadow:t.boxShadow,buttonBorderRadius:t.buttonBorderRadius,buttonColor:t.buttonColor,display:t.display,offsetRight:t.offsetRight,rightOffset:t.rightOffset,width:t.width}}]}).directive("customScrollbar",["$document","scrollbarConfig","$timeout","$window",function(e,t,n,o){return{restrict:"A",link:function(r,s,i){var a,c,l,u,p,d,f,m,g,h,y=s[0].firstChild,v=!1,b=parseInt(o.getComputedStyle(s[0]).getPropertyValue("padding-bottom").replace(/px/,"")),$=parseInt(o.getComputedStyle(s[0]).getPropertyValue("padding-top").replace(/px/,"")),j=function(){a=y.offsetHeight,c=s[0].offsetHeight,l=c-b-$,p=a/l},w=function(){m=c-b-$,g=m*(m/a),h=m-g},x=function(){f.style.height=m+"px",d.style.height=g+"px";var e=parseInt(y.style.top.replace(/px/,"")),t=parseInt(d.style.top.replace(/px/,""));t+g>m&&(y.style.top=e+(t-h)+"px",d.style.top=h+"px")},k=function(){j(),w(),y.style.top="0px",f=document.createElement("div"),f.className="custom-scrollbar",f.style.backgroundColor=t.backgroundColor,f.style.borderRadius=t.borderRadius+"px",f.style.boxShadow=t.boxShadow,f.style.cursor="default",f.style.display=t.display,f.style.height=m+"px",f.style.position="absolute",f.style.right=t.rightOffset+"px",f.style.top=$+"px",f.style.width=t.width+"px",s[0].appendChild(f),d=document.createElement("div"),d.style.borderRadius=t.buttonBorderRadius+"px",d.style.boxShadow=t.boxShadow,d.style.backgroundColor=t.buttonColor,d.style.cursor="default",d.style.height=g+"px",d.style.position="absolute",d.style.top="0px",d.style.width=t.width+"px",f.appendChild(d)},S=!1,_=!1,T={},U=function(){_=!0,a>l?f.style.display="inline":f.style.display="none",r.$apply()},P=function(){_=!1,S||(f.style.display="none"),r.$apply()},C=function(e){var t=e.clientY-T.mouseY;T.mouseY=e.clientY;var n=parseInt(y.style.top.replace(/px/,""))-p*t,o=parseInt(d.style.top.replace(/px/,""))+t;return o<0&&(o=0,n=0),o>h&&(o=h,n=-(p*h)),d.style.top=o+"px",y.style.top=n+"px",r.$apply(),!1},R=function(){S=!1,e.unbind("mousemove",C),e.unbind("mouseup",R),_||(f.style.display="none"),r.$apply()},E=function(t){return T.mouseY=t.clientY,S=!0,e.bind("mousemove",C),e.bind("mouseup",R),r.$apply(),!1},I=function(e){var t=parseInt(y.style.top.replace(/px/,""))-p*e.deltaY,n=parseInt(d.style.top.replace(/px/,""))+e.deltaY;n<0&&(n=0,t=0),n>h&&(n=h,t=-(p*h)),d.style.top=n+"px",y.style.top=t+"px",r.$apply()},O=function(e){e?(s.bind("mouseover",U),s.bind("mouseout",P),s.bind("wheel",I),d.addEventListener("mousedown",E)):(s.unbind("mouseover",U),s.unbind("mouseout",P),s.unbind("wheel",I),d.removeEventListener("mousedown",E),y.style.top="0px",f.style.display="none")},H=function(){j(),w(),x(),O(a>l?!0:!1)};r.$watch(function(){return s.attr("class")},function(e){null===e.match(/ng-hide/)&&(v||(k(),v=!0))}),r.$watch(function(){if(y)return y.offsetHeight},function(){v&&H()}),angular.element(o).bind("resize",function(){v&&(n.cancel(u),u=n(function(){H()},500))})}}}]),function(){"use strict";angular.module("app",["custom.scrollbar","ct.ui.router.extras","ngAnimate","ngMaterial","ngMessages","ngSanitize","PPVN","ui.router"])}(),function(){"use strict";angular.module("app").config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue-grey").accentPalette("orange").foregroundPalette[3]="#455a64"}]).constant("__env",window.__env)}(),function(){"use strict";angular.module("app").run(["$state","$rootScope",function(e,t){t.$state=e}]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,t,n){n.otherwise("/404"),t.state("root",{url:"/",sticky:!0,dsr:!0,views:{admin:{templateUrl:"app/admin/admin.html"},close:{templateUrl:"app/404/close.html"},error:{templateUrl:"app/404/404.html"},home:{templateUrl:"app/home/home.html"},projects:{templateUrl:"app/profile/profile.html"},treasure:{templateUrl:"app/404/treasure.html"}}}).state("root.admin",{url:"admin"}).state("root.close",{url:"treasure"}).state("root.error",{url:"404"}).state("root.home",{url:""}).state("root.projects",{url:"projects",views:{analysis:{templateUrl:"app/profile/analysis/analysis.html"},details:{templateUrl:"app/profile/project/project.html"},help:{templateUrl:"app/profile/help/help.html"},introduction:{templateUrl:"app/profile/introduction.html"},new:{templateUrl:"app/profile/project/project-new.html"},search:{templateUrl:"app/profile/search/search.html"}}}).state("root.projects.analysis",{url:"/analysis"}).state("root.projects.details",{url:"/details?project"}).state("root.projects.help",{url:"/help"}).state("root.projects.new",{url:"/new"}).state("root.projects.search",{url:"/search"}).state("root.treasure",{url:"0111010001110010011001010110000101110011011101010111001001100101"}),e.html5Mode(!0)}])}(),function(){"use strict";angular.module("app").directive("collapse",[function(){return{restrict:"A",link:function(e,t,n){var o=n.collapse,r=t[0].closest("."+o),s=r.querySelector(".collapse-container"),i=r.querySelector(".collapse-header");s.style.transition="all 500ms",s.style.webkitTransition="all 500ms",i.style.transition="all 500ms",i.style.webkitTransition="all 500ms",t.bind("click",function(e){var n=r.querySelector(".collapse-icons-other"),a=r.querySelector('[expand="'+o+'"]');n.style.display="none",s.style.display="none",i.style.display="block",t[0].style.display="none",a.style.display="inline"})}}}]).directive("expand",[function(){return{restrict:"A",link:function(e,t,n){var o=n.expand,r=t[0].closest("."+o);t[0].style.display="none",t.bind("click",function(e){var n=r.querySelector(".collapse-icons-other"),s=r.querySelector('[collapse="'+o+'"]'),i=r.querySelector(".collapse-container"),a=r.querySelector(".collapse-header");n.style.display="inline",s.style.display="inline",i.style.display="block",a.style.display="none",t[0].style.display="none"})}}}])}(),function(){"use strict";angular.module("app").directive("flipMenu",["$timeout",function(e){return{restrict:"A",link:function(t,n,o){var r=o.flipMenu,s=document.getElementById(r),i=o.flipMenuHeight,a=o.flipMenuWidth;s&&(s.style.maxHeight="0px",s.style.minWidth="0px",s.style.overflow="hidden",s.style.transformOrigin="left center",s.style.transform="rotateY(90deg)",s.style.visibility="hidden",s.style.webkitTransform="rotateY(90deg)",s.style.width="0px",s.style.whiteSpace="nowrap",n.bind("click",function(){"rotateY(90deg)"===s.style.webkitTransform?(s.style.transition="all 500ms",s.style.maxHeight=i,s.style.minWidth=a,s.style.transform="rotateY(0deg)",s.style.visibility="visible",s.style.webkitTransform="rotateY(0deg)",s.style.width="auto",e(function(){s.style.whiteSpace="normal"},500)):(s.style.maxHeight="0px",s.style.minWidth="0px",s.style.transform="rotateY(90deg)",s.style.visibility="hidden",s.style.webkitTransform="rotateY(90deg)",s.style.width="0px",s.style.whiteSpace="nowrap")}))}}}])}(),function(){"use strict";angular.module("app").directive("mdTooltipDestroy",[function(){return{restrict:"A",link:function(e,t,n){t.bind("click",function(e){var t=document.getElementsByTagName("md-tooltip")[0];t&&t.remove()})}}}])}(),function(){"use strict";angular.module("app").service("credentials",["$rootScope",function(e){var t={};this.get=function(){return t},this.set=function(n){t=n,e.$broadcast("credentials:updated",t)}}])}(),function(){"use strict";angular.module("app").directive("compile",["$compile",function(e){return function(t,n,o){var r=t.$watch(function(e){return e.$eval(o.compile)},function(o){n.html(o),e(n.contents())(t),r()})}}])}(),function(){"use strict";angular.module("app").service("helperDialog",["$mdDialog",function(e){this.alert=function(t,n){e.show({clickOutsideToClose:!0,controller:"alert",controllerAs:"vm",locals:{message:n,title:t},parent:angular.element(document.body),templateUrl:"app/dialogs/alert/alert.html"})}}])}(),function(){"use strict";angular.module("app").service("helperHTTP",["credentials","__env","helperDialog","$http",function(e,t,n,o){this.set=function(r,s,i,a){var c=e.get();o({method:"POST",url:t.apiUrl+"/"+r,headers:{"Content-Type":"application/json",user:JSON.stringify(c)},data:s}).then(function(e){e.data.status?a(e):i(e)},function(){n.alert("Connection error","The server could not be reached.")})},this.get=function(r,s,i,a){var c=e.get(),l="?";for(var u in s)l+=u+"="+s[u]+"&";o({method:"GET",url:t.apiUrl+"/"+r+"/"+l,headers:{"Content-Type":"application/json",user:JSON.stringify(c)}}).then(function(e){e.data.status?a(e):i(e)},function(){n.alert("Connection error","The server could not be reached.")})}}])}(),function(){"use strict";angular.module("app").service("helperObject",[function(){this.notEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}}])}(),function(){"use strict";angular.module("app").service("helperReport",["__env","$window",function(e,t){this.mail=function(n){t.location.href="mailto:"+e.supportEmail+"?subject="+n}}])}(),function(){"use strict";angular.module("app").controller("alert",["__env","helperReport","$mdDialog","$scope","message","title",function(e,t,n,o,r,s){var i=this;i.close=function(){n.hide()},i.message=r,i.reportError=function(e){t.mail(e)},i.supportName=e.supportName,i.title=s}])}(),function(){"use strict";angular.module("app").controller("404",["__env","helperReport","$scope","$window",function(e,t,n,o){var r=this;r.supportName=e.supportName,r.reportError=function(e){t.mail(e)}}])}(),function(){"use strict";angular.module("app").service("projects",["$rootScope",function(e){var t,n=[];this.add=function(t){n.push(t),e.$broadcast("projects:updated",n)},this.get=function(){return n},this.getCurrent=function(){return t},this.set=function(t){n=JSON.parse(JSON.stringify(t)),e.$broadcast("projects:updated",n)},this.setCurrent=function(n){t=n,e.$broadcast("project:set",t)},this.update=function(t,o,r){var s=n.map(function(e){return e._id}).indexOf(t);n[s][o]=r,e.$broadcast("projects:updated",n)}}])}(),function(){"use strict";angular.module("app").service("screens",["$rootScope",function(e){var t,n=[];this.add=function(t){n.push(t),e.$broadcast("screens:updated",n)},this.get=function(){return n},this.getCurrent=function(){return t},this.set=function(t){n=t,e.$broadcast("screens:updated",n)},this.setCurrent=function(n){t=n,e.$broadcast("screen:set",t)},this.update=function(t,o,r){var s=n.map(function(e){return e._id}).indexOf(t);t[s][o]=r,e.$broadcast("screens:updated",n)}}])}(),function(){"use strict";angular.module("app").service("signinCallbacks",["credentials","helperDialog","helperHTTP","projects","$rootScope",function(e,t,n,o,r){var s={};this.success=function(i){for(var a in i)"object"==typeof i[a]&&i[a].hasOwnProperty("access_token")&&(s.token=i[a].access_token);var c=function(e){var n=gapi.auth2.getAuthInstance();n.disconnect(),t.alert("Sign-in failed",e.data.message)},l=function(t){e.set(t.data.user),r.$broadcast("signin:updated",{text:"Signed in"}),o.set(t.data.projects)};n.set("login",s,l,c)},this.failure=function(t){e.set({})}}])}(),function(){"use strict";angular.module("app").service("signoutUnload",["helperHTTP","$window",function(e,t){t.onbeforeunload=function(){e.set("logout",{},function(){},function(){});var t=gapi.auth2.getAuthInstance();t.disconnect().then(function(){})}}]).run(["signoutUnload",function(e){}])}(),function(){"use strict";angular.module("app").directive("googleSignin",["signinCallbacks",function(e){var t=/\.apps\.googleusercontent\.com$/;return{restrict:"A",link:function(n,o,r){r.clientid+=t.test(r.clientid)?"":".apps.googleusercontent.com";var s={access_type:"offline",clientid:r.clientid,cookiepolicy:"single_host_origin",customtargetid:"google-signin",onfailure:e.failure,onsuccess:e.success,scope:"email"},i=document.getElementsByTagName("link")[0],a=document.createElement("link");a.type="text/css",a.async=!0,a.rel="stylesheet",a.href="https://fonts.googleapis.com/css?family=Roboto",i.parentNode.insertBefore(a,i);var c=document.getElementsByTagName("script")[0],l=document.createElement("script");l.type="text/javascript",l.async=!0,l.src="https://apis.google.com/js/client:platform.js",c.parentNode.insertBefore(l,c),l.onload=function(){gapi.load("auth2",function(){var e=gapi.auth2.init({client_id:s.clientid,cookie_policy:s.cookiepolicy});e.attachClickHandler(s.customtargetid,{},s.onsuccess,s.onfailure)})}}}}])}(),function(){"use strict";angular.module("app").directive("googleSignout",["credentials","$rootScope","$state",function(e,t,n){return{restrict:"A",link:function(n,o,r){o.bind("click",function(n){n.stopPropagation();var o=gapi.auth2.getAuthInstance();o.disconnect().then(function(){e.set({}),t.$broadcast("signin:updated",{text:"Sign in"})})})}}}])}(),function(){"use strict";angular.module("app").controller("signin",["__env","$scope","$state","$timeout",function(e,t,n,o){var r=this;r.clientID=e.clientID,r.signedIn=!1,r.signedInText="Sign in",t.$on("credentials:updated",function(e,s){s.name?(r.signedIn=!0,r.user=s.name,o(function(){t.$digest(),n.go("root.projects")})):(r.signedIn=!1,o(function(){t.$digest()}))}),t.$on("signin:updated",function(e,n){n.text&&(r.signedInText=n.text,o(function(){t.$digest()}))})}])}(),function(){"use strict";angular.module("app").controller("profile",["credentials","helperHTTP","projects","$scope","screens","$state","$timeout",function(e,t,n,o,r,s,i){var a=this;a.newProject=function(){s.go("root.projects.new"),angular.element(document.getElementById("projects-button")).triggerHandler("click")},a.projects=[],a.screens=[],a.selectProject=function(e){if(!a.project||a.project!==e){a.experiment="",a.project=e,a.sample="",a.screen="",n.setCurrent(e);var c=function(e){r.set(e.data.screens),a.screens=e.data.screens,i(function(){o.$digest()})},l=function(e){helperDialog.alert("Error",e.data.message)};t.get("project/screen",{project:e._id},c,l)}s.go("root.projects.details",{project:e._id}),angular.element(document.getElementById("projects-button")).triggerHandler("click")},o.$on("credentials:updated",function(e,t){t.name&&(a.user=t.name,i(function(){o.$digest()}))}),o.$on("projects:updated",function(e,t){a.projects=t,i(function(){o.$digest()})}),o.$on("screens:updated",function(e,t){a.screens=t,i(function(){o.$digest()})})}])}(),function(){"use strict";angular.module("app").controller("project",[function(){var e=this;e.show=""}])}(),function(){"use strict";angular.module("app").controller("projectNew",["credentials","helperHTTP","projects","$scope","$timeout",function(e,t,n,o,r){var s=this;s.form={},s.partialReset=function(){o.form.name="",o.form.description="",o.form.$setPristine(),o.form.$setUntouched(),s.form={}},s.reset=function(){o.form.name="",o.form.description="",o.form.$setPristine(),o.form.$setUntouched(),s.form={},s.message=""},s.submit=function(o,i){if(s.message="",o){var a=e.get(),c={};c.creator=a.name,c.description=i.description,c.title=i.name;var l=function(e){s.reset(),s.message=e.data.message,n.add(e.data.project),r(function(){s.message=""},1e4)},u=function(e){s.message=e.data.message,r(function(){s.message=""},1e4)};t.set("project",c,l,u)}}}])}(),function(){"use strict";angular.module("app").controller("projectManagement",["helperHTTP","helperObject","projects","$scope","$timeout",function(e,t,n,o,r){var s=this;s.addUsers=function(t,o,i,a){var c=[];o&&(c=o);for(var l=0,u=s.searchResults.length;l<u;l++)i[l]&&c.push({name:s.searchResults[l].name,lab:s.searchResults[l].lab,permission:a[l]});var p=function(e){n.update(t,"users",c),s.addUsersMessage=e.data.message,r(function(){s.addUsersMessage=""},1e4)},d=function(e){s.addUsersMessage=e.data.message,r(function(){s.addUsersMessage=""},1e4)};e.set("project/users",{project:t,users:c},p,d)},s.currentPermissions=[],s.manage=!1,s.newPermissions=[],s.newUsers=[],s.reset=function(){o.form.email="",o.form.$setPristine(),o.form.$setUntouched(),s.searchUser={}},s.searchUser={},s.submit=function(n,o){if(n&&t.notEmpty(o)){s.message="";var i=o,a=function(e){s.reset(),e.data.users.length>0?s.searchResults=e.data.users:(s.message="No users matched your search.",r(function(){s.message=""},1e4))},c=function(e){s.message=e.data.message,r(function(){s.message=""},1e4)};e.get("project/users",i,a,c)}},s.updateUsers=function(t,o,i,a){console.log(t,o,i,a);for(var c=o.length-1;c>=0;c--)a&&a[c]?o.splice(c):o[c].permission=i[c];console.log(o);var l=function(e){n.update(t,"users",o),s.manage=!1},u=function(e){s.updateUsersMessage=e.data.message,r(function(){s.updateUsersMessage=""},1e4)};e.set("project/users",{project:t,users:o},l,u)}}])}(),function(){"use strict";angular.module("app").controller("experimentManagement",["credentials","helperDialog","helperHTTP","helperObject","$http","projects","$scope","$timeout",function(e,t,n,o,r,s,i,a){var c=this;c.form={},c.formProtocol={details:[]},c.protocolDetails=!1,c.protocolCreation=!1,c.reset=function(){i.form.comment="",i.form.description="",i.form.protocol="",i.form.$setPristine(),i.form.$setUntouched(),c.form={}},c.submit=function(e,t,r,s){if(e&&o.notEmpty(t)){c.message="";var i=t;i.project=r,i.screen=s;var l=function(e){c.reset(),c.message=e.data.message,a(function(){c.message=""},1e4)},u=function(e){c.message=e.data.message,a(function(){c.message=""},1e4)};n.get("project/screen",i,l,u)}},i.$on("project:set",function(){var o=function(e){console.log(e),c.protocols=e.data.protocols},r=function(e){t.alert("Error",e.data.message)};n.get("project/protocols",{user:e.get().name,project:s.getCurrent()._id},o,r)})}])}(),function(){"use strict";angular.module("app").controller("screenManagement",["helperDialog","helperHTTP","helperObject","$http","$rootScope","$scope","screens","$timeout",function(e,t,n,o,r,s,i,a){var c=this;c.form={},c.reset=function(){s.form.approach="",s.form.cell="",s.form.comment="",s.form.condition="",s.form.description="",s.form.library="",s.form.name="",s.form.species="",s.form.type="",s.form.$setPristine(),s.form.$setUntouched(),c.form={}},c.submit=function(e,o,r,s){if(e&&n.notEmpty(o)){c.message="";var l=o;l.creator=s,l.project=r;var u=function(e){c.reset(),c.message=e.data.message,i.add(e.data.screen),a(function(){c.message=""},1e4)},p=function(e){c.message=e.data.message,a(function(){c.message=""},1e4)};t.set("project/screen",l,u,p)}},o.get("app/profile/screen/resources/options.json").then(function(e){c.approaches=e.data.approaches,c.cells=e.data.cells,c.libraries=e.data.libraries,c.species=e.data.species,c.types=e.data.types,a(function(){s.$digest()})},function(t){e.alert("Resource error","Library information could not be retrieved.")})}])}();