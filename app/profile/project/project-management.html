<div class="flex-row" ng-controller="projectManagement as projectManagementVm">
  <div class="flex-column">
    <div class="flex-row">
      Project owner: {{vm.project.creator}}
    </div>
    <div class="flex-row m-t-5">
      <span class="flex-container" ng-show="vm.project.users">
        Access:
        <table class="results-table white m-l-20">
          <thead>
            <tr>
              <th>
                User
              </th>
              <th>
                Lab
              </th>
              <th>
                Permissions
              </th>
              <th ng-show="projectManagementVm.manage">
                Remove
              </th>
            </tr>
          </thead>
          <tbody ng-repeat="user in vm.project.users">
            <tr>
              <td>
                {{user.name}}
              </td>
              <td>
                {{user.lab}}
              </td>
              <td>
                <span ng-show="!projectManagementVm.manage">
                  {{user.permission}}
                </span>
                <md-select class="md-no-underline no-margins white" ng-init="projectManagementVm.currentPermissions[$index] = user.permission" ng-model="projectManagementVm.currentPermissions[$index]" ng-show="projectManagementVm.manage" placeholder="Permissions">
                  <md-option value="read">Read</md-option>
                  <md-option value="write">Write</md-option>
                </md-select>
              </td>
              <td>
                <md-checkbox aria-label="Remove user" class="md-accent no-margins white" ng-model="projectManagementVm.removeUsers[$index]" ng-show="projectManagementVm.manage">
                </md-checkbox>
              </td>
            </tr>
          </tbody>
        </table>
      </span>
      <div class="flex-container m-l-10 m-t-10">
        <md-button class="md-fab md-small md-accent no-margins" aria-label="Manage users" ng-click="projectManagementVm.manage = !projectManagementVm.manage" ng-show="vm.project.users">
          <i class="fa fa fa-user-circle primary-h700"></i>
          <md-tooltip md-direction="bottom" md-autohide="true">
            Manage users
          </md-tooltip>
        </md-button>
        <md-button class="md-fab md-small md-accent no-margins" aria-label="Add user" ng-click="projectManagementVm.showForm = 'add-user'">
          <i class="fa fa-plus primary-h700"></i>
          <md-tooltip md-direction="bottom" md-autohide="true">
            Add user
          </md-tooltip>
        </md-button>
        <md-button class="md-fab md-small md-accent no-margins m-l-10" aria-label="Update users" ng-click="projectManagementVm.updateUsers(vm.project._id, vm.project.users, projectManagementVm.currentPermissions, projectManagementVm.removeUsers)" ng-show="projectManagementVm.manage">
          <i class="fa fa fa-arrow-circle-right primary-h700"></i>
          <md-tooltip md-direction="bottom" md-autohide="true">
            Update users
          </md-tooltip>
        </md-button>
      </div>
    </div>
    <div class="flex-row m-t-10 form-warning" ng-show="projectManagementVm.updateUsersMessage">
      &#x2022; {{projectManagementVm.updateUsersMessage}}
    </div>
    <div class="flex-row m-t-20" ng-show="projectManagementVm.showForm === 'add-user'">
      <div class="flex-column form-container md-form-font">
        <form name="form" ng-submit="projectManagementVm.submit(form.$valid, projectManagementVm.searchUser)" novalidate>
          <div class="form-description">
            &#x2022; Search for users by name, lab or Gmail address
          </div>
          <md-input-container class="md-icon-float md-block md-small-margin">
            <label>Name</label>
            <md-icon md-font-icon="fa-user-circle" class="fa md-accent"></md-icon>
            <input ng-model="projectManagementVm.searchUser.name" type="text">
          </md-input-container>
          <md-input-container class="md-icon-float md-block md-small-margin">
            <label>Lab</label>
            <md-icon md-font-icon="fa-flask" class="fa md-accent"></md-icon>
            <input ng-model="projectManagementVm.searchUser.lab" type="text">
          </md-input-container>
          <md-input-container class="md-icon-float md-block md-small-margin">
            <label>e-mail</label>
            <md-icon md-font-icon="fa-envelope " class="fa md-accent"></md-icon>
            <input name="email" ng-model="projectManagementVm.searchUser.email" ng-pattern="/^.+@.+\..+$/" type="email">
            <div ng-messages="form.email.$error" role="alert">
              <div ng-message="pattern">Please enter a valid e-mail</div>
            </div>
          </md-input-container>
          <div class="form-warning" ng-show="projectManagementVm.message">
            &#x2022; {{projectManagementVm.message}}
          </div>
          <div class="flex-row form-buttons">
            <div class="button-container">
              <md-button class="md-fab md-small md-accent no-margins" aria-label="Close" ng-click="projectManagementVm.showForm = ''">
                <i class="fa fa-times primary-h700"></i>
                <md-tooltip md-direction="bottom" md-autohide="true">
                  Close
                </md-tooltip>
              </md-button>
            </div>
            <div class="button-container m-l-10">
              <md-button class="md-fab md-small md-accent no-margins" aria-label="Reset form" ng-click="projectManagementVm.reset()">
                <i class="fa fa-refresh primary-h700"></i>
                <md-tooltip md-direction="bottom" md-autohide="true">
                  Reset
                </md-tooltip>
              </md-button>
            </div>
            <div class="button-container m-l-10">
              <md-button class="md-fab md-small md-accent no-margins" aria-label="Submit" type="submit">
                <i class="fa fa-arrow-circle-right primary-h700"></i>
                <md-tooltip md-direction="bottom" md-autohide="true">
                  Submit
                </md-tooltip>
              </md-button>
            </div>
          </div>
        </form>
      </div>
      <div class="flex-column form-container md-form-font m-l-10" ng-show="projectManagementVm.searchResults">
        <div class="form-description">
          Results:
        </div>
        <table class="results-table primary">
          <thead>
            <tr>
              <th>
                User
              </th>
              <th>
                Lab
              </th>
              <th>
                Permissions
              </th>
              <th>
                Add
              </th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="user in projectManagementVm.searchResults track by $index">
              <td>
                {{user.name}}
              </td>
              <td>
                {{user.lab}}
              </td>
              <td>
                <md-select class="md-no-underline no-margins" ng-model="projectManagementVm.newPermissions[$index]" placeholder="Permissions">
                  <md-option value="read" selected>Read</md-option>
                  <md-option value="write">Write</md-option>
                </md-select>
              </td>
              <td>
                <md-checkbox aria-label="Add user" class="md-accent no-margins" ng-model="projectManagementVm.newUsers[$index]">
                </md-checkbox>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="form-warning" ng-show="projectManagementVm.addUsersMessage">
          &#x2022; {{projectManagementVm.addUsersMessage}}
        </div>
        <div class="flex-row form-buttons">
          <div class="button-container">
            <md-button class="md-fab md-small md-accent no-margins" aria-label="Close" ng-click="projectManagementVm.searchResults = ''">
              <i class="fa fa-times primary-h700"></i>
              <md-tooltip md-direction="bottom" md-autohide="true">
                Close
              </md-tooltip>
            </md-button>
          </div>
          <div class="button-container m-l-10">
            <md-button class="md-fab md-small md-accent no-margins" aria-label="Add users" ng-click="projectManagementVm.addUsers(vm.project._id, vm.project.users, projectManagementVm.newUsers, projectManagementVm.newPermissions)">
              <i class="fa fa-arrow-circle-right primary-h700"></i>
              <md-tooltip md-direction="bottom" md-autohide="true">
                Submit
              </md-tooltip>
            </md-button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
